{% extends "base.html" %}
{% block title %}{{ collection.name }} - Purposefully Made KC{% endblock %}
{% block extra_css %}
<style>
.collection-hero {
    background: linear-gradient(135deg, var(--ivory-silk) 0%, var(--cashmere-sand) 50%, rgba(184, 124, 111, 0.2) 100%);
    padding: 4rem 0;
    text-align: center;
    border-bottom: 1px solid var(--border-light);
}
.collection-hero h1 {
    font-family: var(--font-heading);
    font-size: clamp(2rem, 5vw, 3.5rem);
    color: var(--midnight-charcoal);
    margin-bottom: 0.5rem;
}

.collection-hero .subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

.collection-hero .subtitle a {
    color: var(--accent-color);
}

.design-board {
    padding: 4rem 0 6rem;
}

.design-board-intro {
    text-align: center;
    max-width: 600px;
    margin: 0 auto 3rem;
}

.design-board-intro h2 {
    font-family: var(--font-heading);
    font-size: 1.75rem;
    color: var(--primary-color);
    margin-bottom: 0.75rem;
}

.design-board-intro p {
    color: var(--text-secondary);
    margin-bottom: 0;
}

.design-board-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.design-card {
    background: #fff;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
    border: 1px solid var(--border-light);
    position: relative;
}

.design-card:hover {
    box-shadow: var(--box-shadow-luxury);
    transform: translateY(-4px);
    border-color: var(--accent-color);
}

.design-card a {
    display: block;
    text-decoration: none;
    color: inherit;
}

.design-card-image {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
    background: linear-gradient(135deg, #faf8f5 0%, var(--secondary-color) 100%);
}

.design-card-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 1.5rem;
}

.design-card .color-carousel {
    position: relative;
    height: 100%;
}

.design-card .carousel-images {
    position: relative;
    height: 100%;
}

.design-card .carousel-slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.4s ease;
}

.design-card .carousel-slide.active {
    opacity: 1;
    position: relative;
}

.design-card .carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 1rem;
}

.design-card .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(255,255,255,0.95);
    border: 1px solid var(--border-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    transition: var(--transition);
}

.design-card .carousel-btn:hover {
    background: var(--accent-color);
    color: #fff;
    border-color: var(--accent-color);
}

.design-card .carousel-prev { left: 0.5rem; }
.design-card .carousel-next { right: 0.5rem; }

.design-card .color-indicator {
    position: absolute;
    bottom: 0.5rem;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(58,61,72,0.85);
    color: #fff;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
}

.design-card .color-indicator .current-color {
    font-weight: 600;
}

.design-card-content {
    padding: 1.5rem;
}

.design-card-content h3 {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    margin-bottom: 0.25rem;
    color: var(--primary-color);
}

.design-card-content .style-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
}

.design-card-content .sizes-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.color-swatches {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
}

.color-swatch {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid rgba(0,0,0,0.15);
    display: inline-block;
    background: #e8e8e8;
    font-size: 0.6rem;
    text-align: center;
    line-height: 16px;
}

.color-swatch-more {
    font-size: 0.7rem;
    color: var(--text-secondary);
    display: inline-flex;
    align-items: center;
}

.design-card-content .price-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 0.75rem;
}

.design-card-content .price {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--accent-color);
}

.design-card-content .cta {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.25rem;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: #fff;
    background: linear-gradient(135deg, #B87C6F 0%, #7F6C50 100%);
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(184, 124, 111, 0.35);
    transition: all 0.3s ease;
}

.design-card:hover .design-card-content .cta {
    background: linear-gradient(135deg, #a06d60 0%, #6d5d45 100%);
    box-shadow: 0 4px 16px rgba(184, 124, 111, 0.45);
    transform: translateY(-1px);
}

.design-card-content .cta::after {
    content: "→";
    font-size: 1em;
    opacity: 0.9;
    transition: transform 0.3s ease;
}

.design-card:hover .design-card-content .cta::after {
    transform: translateX(2px);
}

.design-board-empty {
    text-align: center;
    padding: 4rem 2rem;
    background: #fff;
    border-radius: var(--border-radius);
    border: 2px dashed var(--border-color);
}

.design-board-empty h2 {
    font-family: var(--font-heading);
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

@media (max-width: 768px) {
    .collection-hero { padding: 2.5rem 0; }
    .design-board { padding: 2rem 0 4rem; }
    .design-board-grid { gap: 1.5rem; }
}
</style>
{% endblock %}
{% block content %}
<div class="collection-hero">
    <div class="container">
        <h1>{{ collection.name }}</h1>
        {% if collection.description %}
        <p class="subtitle">{{ collection.description }}</p>
        {% endif %}
        {% if collection.order_deadline %}
        <p class="subtitle">Order deadline: {{ collection.order_deadline.strftime('%B %d, %Y') }}</p>
        {% endif %}
    </div>
</div>

<section class="design-board">
    <div class="container">
        <div class="design-board-intro">
            <h2>Your Design Board</h2>
            {% if collection.restrict_options %}
            <p>Your organizer has chosen the options for this order. Pick your size and add to cart — everyone stays matching!</p>
            {% else %}
            <p>Choose your style, color, size, and logo. Click any item to customize — pick your options and add to your order.</p>
            {% endif %}
        </div>

        {% if unavailable_products %}
        <div class="alert alert-warning" style="max-width: 700px; margin: 0 auto 2rem; padding: 1rem 1.25rem; background: rgba(184, 124, 111, 0.12); border: 1px solid rgba(184, 124, 111, 0.4); border-radius: 8px; color: var(--text-primary);">
            <strong>Some styles are not available in your chosen colors.</strong><br>
            The following items don't come in the colors selected for this order and have been hidden: {{ unavailable_products | join(', ') }}.
        </div>
        {% endif %}

        {% if products %}
        <div class="design-board-grid">
            {% for product in products %}
            <article class="design-card">
                <a href="{{ url_for('shop.customize', product_id=product.id) }}">
                    <div class="design-card-image">
                        {% if product.carousel_colors and product.carousel_colors|length > 0 %}
                        <div class="color-carousel" data-product-id="{{ product.id }}">
                            <div class="carousel-images">
                                {% for variant in product.carousel_colors %}
                                <div class="carousel-slide {% if loop.first %}active{% endif %}" data-color="{{ variant.color_name }}">
                                    <img src="{{ variant.front_image_url }}" 
                                         alt="{{ product.name }} – {{ variant.color_name }}"
                                         onerror="this.src='{{ url_for('static', filename='img/placeholder-product.svg') }}'">
                                </div>
                                {% endfor %}
                            </div>
                            {% if product.carousel_colors|length > 1 %}
                            <button class="carousel-btn carousel-prev" type="button" aria-label="Previous color">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <button class="carousel-btn carousel-next" type="button" aria-label="Next color">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <div class="color-indicator">
                                <span class="current-color">{{ product.carousel_colors[0].color_name }}</span>
                                <span>{{ product.carousel_colors|length }} colors</span>
                            </div>
                            {% endif %}
                        </div>
                        {% else %}
                        <img src="{{ url_for('static', filename='img/products/' + product.style_number + '.jpg') }}" 
                             alt="{{ product.name }}"
                             onerror="this.src='{{ url_for('static', filename='img/placeholder-product.svg') }}'">
                        {% endif %}
                    </div>
                    <div class="design-card-content">
                        <h3>{{ product.name }}</h3>
                        <p class="style-label">Style {{ product.style_number }}{% if product.category %} · {{ product.category }}{% endif %}</p>
                        {% if product.available_sizes_list %}
                        <p class="sizes-label">Sizes: {{ product.available_sizes_list | join(', ') }}</p>
                        {% endif %}
                        {% if product.carousel_colors %}
                        <div class="color-swatches">
                            {% for v in product.carousel_colors[:6] %}
                            <span class="color-swatch" title="{{ v.color_name }}" style="{% if v.color_hex %}background-color: {{ v.color_hex }};{% else %}background: linear-gradient(135deg, #ddd, #bbb);{% endif %}"></span>
                            {% endfor %}
                            {% if product.carousel_colors|length > 6 %}
                            <span class="color-swatch-more">+{{ product.carousel_colors|length - 6 }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                        <div class="price-row">
                            <span class="price">${{ "%.2f"|format(product.base_price) }}</span>
                            <span class="cta">Customize</span>
                        </div>
                    </div>
                </a>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="design-board-empty">
            <h2>No items yet</h2>
            <p>Products for this collection haven't been added yet. Check back soon.</p>
        </div>
        {% endif %}
    </div>
</section>

<script>
document.querySelectorAll('.color-carousel').forEach(carousel => {
    const slides = carousel.querySelectorAll('.carousel-slide');
    const prev = carousel.querySelector('.carousel-prev');
    const next = carousel.querySelector('.carousel-next');
    const indicator = carousel.querySelector('.current-color');
    if (slides.length <= 1) return;

    let i = 0;
    const go = (idx) => {
        i = (idx + slides.length) % slides.length;
        slides.forEach((s, j) => s.classList.toggle('active', j === i));
        if (indicator) indicator.textContent = slides[i].dataset.color;
    };

    if (prev) prev.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); go(i - 1); });
    if (next) next.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); go(i + 1); });
});
</script>
{% endblock %}
